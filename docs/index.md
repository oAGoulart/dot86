---
layout: default
---

{% include head.html %}

# A 32-bit variable instruction encoding RISC ISA

## overview

Hello, there!

**NOTE**: This is an work-in-progress class assignment which consists of: implementing the datapath of a processor (e.g., MIPS unicycle or multicycle) to simulate the execution of an assembly language program according to the instruction set of the architecture defined by the students.

Made with inspiration from the widely known `i386` and `amd64` architectures, using instructions with different sizes and addressing modes, and a small number of general registers. The main focus was to make a general-purpose architecture.

This architecture can support up to 256 instructions, all instruction are limited to a size of 48 bits, including its opcode. There are 8 registers available, of which 4 are general purpose, 2 for stack handling, and 2 for vector handling. Memory addressing is made exclusively with 32 bits, except at `ins_mem`.

### Basic information

- Bits: 32
- Maximum number of operands: 2
- Type: Registerâ€“Memory
- Design: RISC
- Number of registers: 8
- Instruction encoding: variable (8 to 48 bits)

#### Useful literature

**DISCLAIMER**: _Under section 107 of the Copyright Act 1976, allowance is made for "fair use" for purposes such as criticism, comment, teaching, education, scholarship and research. Fair use is a use permitted by the copyright statute that might otherwise be infringing. Non-profit, educational or personal use tips the balance in favor of fair use._

[PATTERSON, Computer Organization and Design](http://home.ustc.edu.cn/~louwenqi/reference_books_tools/Computer_Organization_and_Design_3Rd.pdf)

[BRYANT, Computer Systems (2002)](http://gec.di.uminho.pt/DISCIP/LEI/ac0708/te%C3%B3ricas/capiv.pdf)

[BRYANT, Computer Systems (2015)](http://www.csapp.cs.cmu.edu/2e/ch4-preview.pdf)

[BISTRICEANU, CPU Implementation](http://www.cs.iit.edu/~virgil/cs470/Book/chapter5.pdf)

[DAMIAN, Logic Gates - Building an ALU](http://www.csc.villanova.edu/~mdamian/Past/csc2400fa13/assign/ALU.html)

[SCHMALZ, Organization of Computer Systems](https://www.cise.ufl.edu/~mssz/CompOrg/CDA-lang.html)

### Instruction encoding

This section will discuss how instructions in this architecture are implemented. In the [repository](https://github.com/oAGoulart/dot86), you will find an assembly encoder written in `C++`, with it you should be able to generate a binary code compatible with this architecture, for reference you can try it out with the examples found in the same repository.

Here's an example of assembly code to machine code generated by the tool above:

<div class="data">
  <div class="textual">
    {%highlight nasm%}
    add RB, RA
    add RB, [SP]
    add RB, [SP+30]
    add RB, [30]
    add [RB], RA
    add [SP+30], RB
    add [30], RB
    add RA, 250
    add RA, 60908070
    {%endhighlight%}
  </div>
  <div class="textual binary">
    {%highlight nix%}
    00 C8
    00 0C
    00 4C 1E
    00 0D 1E 00 00 00
    01 01
    01 4C 1E
    01 0D 1E 00 00 00
    02 FA 00 00 00
    02 26 62 A1 03
    {%endhighlight%}
  </div>
</div>

#### 8-bits operation code

The eight most-significant bits read from `ins_mem` (from bit **47** to bit **40**) at position `pc` will always be used as the operation code. An instruction mnemonic abreviation can have multiple opcodes which will determine the types of operands and memory addressing modes. The table below lists all currently implemented instructions in this architecture:

<div class="table-container">
  <table class="table-styled">
    <thead>
      <tr>
        <th>opcode</th>
        <th>mnemonic</th>
        <th>op1</th>
        <th>op2</th>
        <th>sz</th>
        <th>desc</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>00</td>
        <td>add</td>
        <td>r</td>
        <td>r/m</td>
        <td>2:6</td>
        <td>adds <strong>r</strong> and <strong>r/m</strong>, stores at <strong>r</strong></td>
      </tr>
      <tr>
        <td>01</td>
        <td>add</td>
        <td>m</td>
        <td>r</td>
        <td>2:6</td>
        <td>adds <strong>m</strong> and <strong>r</strong>, stores at <strong>m</strong></td>
      </tr>
      <tr>
        <td>02</td>
        <td>add</td>
        <td>RA</td>
        <td>imm32</td>
        <td>5</td>
        <td>adds <strong>RA</strong> and <strong>imm32</strong>, stores at <strong>RA</strong></td>
      </tr>
    </tbody>
  </table>
</div>

r
: from register, does not have an effective address

m
: direct, register indirect, base plus offset

imm32
: immediate value

#### 8-bits ModR/M value

The ModR/M byte is used to determine the operands of some instructions, those that don't use the ModR/M byte either have a fixed register as operand number one or they do not interact with the `reg_file` and `ram` components. This byte is composed of the following fields:

<div class="data">
  <div class="bit two">
    <p>Mod<br><span class="rep">[7..6]</span></p>
  </div>
  <div class="bit three">
    <p>Register<br><span class="rep">[5..3]</span></p>
  </div>
  <div class="bit three">
    <p>R/M<br><span class="rep">[2..0]</span></p>
  </div>
</div>

If present, this value will be read from `ins_mem` from bit **39** to bit **32** at position `pc`. The bit structure above represents the following table, remembering that the ModR/M byte will always be the same given an instruction where operands are swapped, what will determine the correct operand is the `ctrl_unit`:

<div class="table-container">
  <table class="table-styled">
    <thead>
      <tr>
        <th></th>
        <th></th>
        <th></th>
        <th>RA</th>
        <th>RB</th>
        <th>RC</th>
        <th>RD</th>
        <th>SP</th>
        <th>BP</th>
        <th>SI</th>
        <th>DI</th>
      </tr>
      <tr>
        <th>Effective Address</th>
        <th>Mod</th>
        <th>R/M</th>
        <th class="hollow">000</th>
        <th class="hollow">001</th>
        <th class="hollow">010</th>
        <th class="hollow">011</th>
        <th class="hollow">100</th>
        <th class="hollow">101</th>
        <th class="hollow">110</th>
        <th class="hollow">111</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="hollow">[RA]</td>
        <td class="hollow">00</td>
        <td class="hollow">000</td>
        <td>00</td>
        <td>08</td>
        <td>10</td>
        <td>18</td>
        <td>20</td>
        <td>28</td>
        <td>30</td>
        <td>38</td>
      </tr>
      <tr>
        <td class="hollow">[RB]</td>
        <td class="hollow"></td>
        <td class="hollow">001</td>
        <td>01</td>
        <td>09</td>
        <td>11</td>
        <td>19</td>
        <td>21</td>
        <td>29</td>
        <td>31</td>
        <td>39</td>
      </tr>
      <tr>
        <td class="hollow">[RC]</td>
        <td class="hollow"></td>
        <td class="hollow">010</td>
        <td>02</td>
        <td>0A</td>
        <td>12</td>
        <td>1A</td>
        <td>22</td>
        <td>2A</td>
        <td>32</td>
        <td>3A</td>
      </tr>
      <tr>
        <td class="hollow">[RD]</td>
        <td class="hollow"></td>
        <td class="hollow">011</td>
        <td>03</td>
        <td>0B</td>
        <td>13</td>
        <td>1B</td>
        <td>23</td>
        <td>2B</td>
        <td>33</td>
        <td>3B</td>
      </tr>
      <tr>
        <td class="hollow">[SP]</td>
        <td class="hollow"></td>
        <td class="hollow">100</td>
        <td>04</td>
        <td>0C</td>
        <td>14</td>
        <td>1C</td>
        <td>24</td>
        <td>2C</td>
        <td>34</td>
        <td>3C</td>
      </tr>
      <tr>
        <td class="hollow">disp32</td>
        <td class="hollow"></td>
        <td class="hollow">101</td>
        <td>05</td>
        <td>0D</td>
        <td>15</td>
        <td>1D</td>
        <td>25</td>
        <td>2D</td>
        <td>35</td>
        <td>3D</td>
      </tr>
      <tr>
        <td class="hollow">[SI]</td>
        <td class="hollow"></td>
        <td class="hollow">110</td>
        <td>06</td>
        <td>0E</td>
        <td>16</td>
        <td>1E</td>
        <td>26</td>
        <td>2E</td>
        <td>36</td>
        <td>3E</td>
      </tr>
      <tr>
        <td class="hollow">[DI]</td>
        <td class="hollow"></td>
        <td class="hollow">111</td>
        <td>07</td>
        <td>0F</td>
        <td>17</td>
        <td>1F</td>
        <td>27</td>
        <td>2F</td>
        <td>37</td>
        <td>3F</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[RA]+disp8</td>
        <td class="hollow">01</td>
        <td class="hollow">000</td>
        <td>40</td>
        <td>48</td>
        <td>50</td>
        <td>58</td>
        <td>60</td>
        <td>68</td>
        <td>70</td>
        <td>78</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[RB]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">001</td>
        <td>41</td>
        <td>49</td>
        <td>51</td>
        <td>59</td>
        <td>61</td>
        <td>69</td>
        <td>71</td>
        <td>79</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[RC]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">010</td>
        <td>42</td>
        <td>4A</td>
        <td>52</td>
        <td>5A</td>
        <td>62</td>
        <td>6A</td>
        <td>72</td>
        <td>7A</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[RD]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">011</td>
        <td>43</td>
        <td>4B</td>
        <td>53</td>
        <td>5B</td>
        <td>63</td>
        <td>6B</td>
        <td>73</td>
        <td>7B</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[SP]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">100</td>
        <td>44</td>
        <td>4C</td>
        <td>54</td>
        <td>5C</td>
        <td>64</td>
        <td>6C</td>
        <td>74</td>
        <td>7C</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[BP]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">101</td>
        <td>45</td>
        <td>4D</td>
        <td>55</td>
        <td>5D</td>
        <td>65</td>
        <td>6D</td>
        <td>75</td>
        <td>7D</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[SI]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">110</td>
        <td>46</td>
        <td>4E</td>
        <td>56</td>
        <td>5E</td>
        <td>66</td>
        <td>6E</td>
        <td>76</td>
        <td>7E</td>
      </tr>
      <tr class="odd">
        <td class="hollow">[SI]+disp8</td>
        <td class="hollow"></td>
        <td class="hollow">111</td>
        <td>47</td>
        <td>4F</td>
        <td>57</td>
        <td>5F</td>
        <td>67</td>
        <td>6F</td>
        <td>77</td>
        <td>7F</td>
      </tr>
      <tr>
        <td class="hollow">[RA]+disp32</td>
        <td class="hollow">10</td>
        <td class="hollow">000</td>
        <td>80</td>
        <td>88</td>
        <td>90</td>
        <td>98</td>
        <td>A0</td>
        <td>A8</td>
        <td>B0</td>
        <td>B8</td>
      </tr>
      <tr>
        <td class="hollow">[RB]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">001</td>
        <td>81</td>
        <td>89</td>
        <td>91</td>
        <td>99</td>
        <td>A1</td>
        <td>A9</td>
        <td>B1</td>
        <td>B9</td>
      </tr>
      <tr>
        <td class="hollow">[RC]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">010</td>
        <td>82</td>
        <td>8A</td>
        <td>92</td>
        <td>9A</td>
        <td>A2</td>
        <td>AA</td>
        <td>B2</td>
        <td>BA</td>
      </tr>
      <tr>
        <td class="hollow">[RD]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">011</td>
        <td>83</td>
        <td>8B</td>
        <td>93</td>
        <td>9B</td>
        <td>A3</td>
        <td>AB</td>
        <td>B3</td>
        <td>BB</td>
      </tr>
      <tr>
        <td class="hollow">[SP]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">100</td>
        <td>84</td>
        <td>8C</td>
        <td>94</td>
        <td>9C</td>
        <td>A4</td>
        <td>AC</td>
        <td>B4</td>
        <td>BC</td>
      </tr>
      <tr>
        <td class="hollow">[BP]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">101</td>
        <td>85</td>
        <td>8D</td>
        <td>95</td>
        <td>9D</td>
        <td>A5</td>
        <td>AD</td>
        <td>B5</td>
        <td>BD</td>
      </tr>
      <tr>
        <td class="hollow">[SI]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">110</td>
        <td>86</td>
        <td>8E</td>
        <td>96</td>
        <td>9E</td>
        <td>A6</td>
        <td>AE</td>
        <td>B6</td>
        <td>BE</td>
      </tr>
      <tr>
        <td class="hollow">[DI]+disp32</td>
        <td class="hollow"></td>
        <td class="hollow">111</td>
        <td>87</td>
        <td>8F</td>
        <td>97</td>
        <td>9F</td>
        <td>A7</td>
        <td>AF</td>
        <td>B7</td>
        <td>BF</td>
      </tr>
      <tr class="odd">
        <td class="hollow">RA</td>
        <td class="hollow">11</td>
        <td class="hollow">000</td>
        <td>C0</td>
        <td>C8</td>
        <td>D0</td>
        <td>D8</td>
        <td>E0</td>
        <td>E8</td>
        <td>F0</td>
        <td>F8</td>
      </tr>
      <tr class="odd">
        <td class="hollow">RB</td>
        <td class="hollow"></td>
        <td class="hollow">001</td>
        <td>C1</td>
        <td>C9</td>
        <td>D1</td>
        <td>D9</td>
        <td>E1</td>
        <td>E9</td>
        <td>F1</td>
        <td>F9</td>
      </tr>
      <tr class="odd">
        <td class="hollow">RC</td>
        <td class="hollow"></td>
        <td class="hollow">010</td>
        <td>C2</td>
        <td>CA</td>
        <td>D2</td>
        <td>DA</td>
        <td>E2</td>
        <td>EA</td>
        <td>F2</td>
        <td>FA</td>
      </tr>
      <tr class="odd">
        <td class="hollow">RD</td>
        <td class="hollow"></td>
        <td class="hollow">011</td>
        <td>C3</td>
        <td>CB</td>
        <td>D3</td>
        <td>DB</td>
        <td>E3</td>
        <td>EB</td>
        <td>F3</td>
        <td>FB</td>
      </tr>
      <tr class="odd">
        <td class="hollow">SP</td>
        <td class="hollow"></td>
        <td class="hollow">100</td>
        <td>C4</td>
        <td>CC</td>
        <td>D4</td>
        <td>DC</td>
        <td>E4</td>
        <td>EC</td>
        <td>F4</td>
        <td>FC</td>
      </tr>
      <tr class="odd">
        <td class="hollow">BP</td>
        <td class="hollow"></td>
        <td class="hollow">101</td>
        <td>C5</td>
        <td>CD</td>
        <td>D5</td>
        <td>DD</td>
        <td>E5</td>
        <td>ED</td>
        <td>F5</td>
        <td>FD</td>
      </tr>
      <tr class="odd">
        <td class="hollow">SI</td>
        <td class="hollow"></td>
        <td class="hollow">110</td>
        <td>C6</td>
        <td>CE</td>
        <td>D6</td>
        <td>DE</td>
        <td>E6</td>
        <td>EE</td>
        <td>F6</td>
        <td>FE</td>
      </tr>
      <tr class="odd">
        <td class="hollow">DI</td>
        <td class="hollow"></td>
        <td class="hollow">111</td>
        <td>C7</td>
        <td>CF</td>
        <td>D7</td>
        <td>DF</td>
        <td>E7</td>
        <td>EF</td>
        <td>F7</td>
        <td>FF</td>
      </tr>
    </tbody>
  </table>
</div>

{% include foot.html %}
